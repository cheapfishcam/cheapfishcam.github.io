<!DOCTYPE html>
<html>
<head>
  <title>Calls and Balls</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>

 <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
   integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
   crossorigin=""></script>

  <style>
    body {
      padding: 0;
      margin: 0;
    }
    html, body, #map {
      height: 95%;
      width: 95%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>



var config = {
    apiKey: "AIzaSyCymOh_cE-oA2jZo9PeruW1jacINPCxshQ",
    authDomain: "testingwebrtc-d087c.firebaseapp.com",
    databaseURL: "https://testingwebrtc-d087c.firebaseio.com",
    projectId: "testingwebrtc-d087c",
    storageBucket: "testingwebrtc-d087c.appspot.com",
    messagingSenderId: "864357972075"
  };


    var map = L.map('map');
    var ball = {
       pos: {lat: 0,lng: 0},
       direction: { x: 0, y: 0 },
       speed: 0.005,
       brake: 0.9, // smaller number stop faster, max 0.99999
       broadcasting: 0,
               };

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(map);

    
    var current_position;
    var myBall;
    function onLocationFound(e) {
      //current_position = L.marker(e.latlng).addTo(map);
      ball.pos.lat = e.latlng.lat;
      ball.pos.lng = e.latlng.lng;
      myBall = L.circle([ball.pos.lat, ball.pos.lng], {radius: 200, color: "red", fillOpacity: 1.0}).addTo(map);
                                 }

    map.on('locationfound', onLocationFound);
    map.locate({setView: true, maxZoom: 16});

    document.addEventListener('keydown', event => {
      if (event.keyCode === 37) { //Left
        ball.direction.x += -1;
      } else if (event.keyCode === 39) { //Right
        ball.direction.x += 1;
      } else if (event.keyCode === 38) { //Up
        ball.direction.y += 1;
      } else if (event.keyCode === 40) { //Down
        ball.direction.y += -1;
      }
  });


     function animate() {
          ball.pos.lng += ball.direction.x * ball.speed;
	  ball.pos.lat += ball.direction.y * ball.speed;
	  ball.direction.x *= ball.brake;
          ball.direction.y *= ball.brake;
                        }


     function gameBack() {
          if(myBall){map.removeLayer(myBall);}
          myBall = L.circle([ball.pos.lat, ball.pos.lng], {radius: 200, color: "red", fillOpacity: 1.0}).addTo(map);
          map.setView(new L.LatLng(ball.pos.lat, ball.pos.lng), 8);
                         }

     var FPS = 30;
     setInterval(function() {
          animate();
          gameBack();
    }, 1000/FPS);


  </script>
</body>
</html>